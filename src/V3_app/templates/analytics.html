{% extends "base.html" %}

{% block title %}Analytics - Financial App V3{% endblock %}

{% block head_extra %}
    {# Add any page-specific CSS or meta tags here if needed later #}
    {# --- Add Chart.js CDN --- #}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    {# --- Add Zoom Plugin CDN --- #}
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    {# --- End Chart.js CDN --- #}
    {# --- DataTables CSS --- #}
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
    {# --- End DataTables CSS --- #}
    <style>
        /* Style for filter rows */
        .filter-row {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            border: 1px solid var(--bs-border-color-translucent);
            border-radius: 0.25rem;
        }
        .filter-row select,
        .filter-row input {
            margin-right: 0.5rem;
        }
        /* Style for output area */
        #processed-analytics-output {
            background-color: var(--bs-body-bg); /* Use CSS var for theme adapt */
            border: 1px solid var(--bs-border-color); /* Use CSS var for theme adapt */
            color: var(--bs-body-color); /* Ensure text color matches theme */
            padding: 15px;
            margin-top: 15px;
            max-height: 600px; /* Increased height */
            overflow-y: auto;
            white-space: pre-wrap; /* Allow wrapping */
            word-wrap: break-word; /* Break long words/strings */
            font-family: monospace; /* Good for JSON */
            font-size: 0.85rem;
        }
        /* Style for drag-and-drop area */
        #drop-zone {
            border: 2px dashed var(--bs-secondary-color);
            border-radius: 0.375rem; /* Match Bootstrap's default border radius */
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            background-color: var(--bs-tertiary-bg);
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }
        #drop-zone.dragover {
            border-color: var(--bs-primary);
            background-color: var(--bs-primary-bg-subtle);
        }
        #drop-zone p {
            margin-bottom: 0;
            color: var(--bs-body-color); /* Use main body color for better contrast */
        }
    </style>
{% endblock %}

{% block content %}
    {# Analytics Page Content #}
    <h1>Analytics</h1>
    <p>import, process, filter, configure, and report on financial data.</p>

    {# --- Main Workflow Tabs --- #}
    <ul class="nav nav-tabs mt-3" id="mainWorkflowTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="fetch-tab" data-bs-toggle="tab" data-bs-target="#fetch-tab-pane" type="button" role="tab" aria-controls="fetch-tab-pane" aria-selected="true"><i class="bi bi-cloud-arrow-down me-1"></i>Fetch</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="stage-prepare-tab" data-bs-toggle="tab" data-bs-target="#stage-prepare-tab-pane" type="button" role="tab" aria-controls="stage-prepare-tab-pane" aria-selected="false"><i class="bi bi-filter-square me-1"></i>Stage & Prepare</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="transform-tab" data-bs-toggle="tab" data-bs-target="#transform-tab-pane" type="button" role="tab" aria-controls="transform-tab-pane" aria-selected="false"><i class="bi bi-gear me-1"></i>Transform</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="analyze-present-tab" data-bs-toggle="tab" data-bs-target="#analyze-present-tab-pane" type="button" role="tab" aria-controls="analyze-present-tab-pane" aria-selected="false"><i class="bi bi-bar-chart-line me-1"></i>Analyze & Present</button>
        </li>
    </ul>
    {# --- End Main Workflow Tabs --- #}

    {# --- Main Tab Content --- #}
    <div class="tab-content pt-3" id="mainWorkflowTabsContent">

        {# --- Data Import Tab Pane --- #}
        <div class="tab-pane fade show active" id="fetch-tab-pane" role="tabpanel" aria-labelledby="fetch-tab" tabindex="0">
            <h5>Data Import Sources</h5>
            <p>Import raw data from external sources.</p>

            {# --- Finviz Import Card --- #}
            <div class="my-3 p-3 border rounded bg-body-tertiary">
                <h5 class="mb-3">Import from Finviz</h5>
                <div class="row gy-3"> {# Use row with gutter spacing #}
                    
                    {# --- Column 1: Screened Tickers --- #}
                    <div class="col-md-6">
                        <h6>All Tracked Tickers</h6>
                        <p class="small text-muted mb-2">Fetch data for tickers currently in the <strong>tracker list</strong>.</p>
                        <button id="run-finviz-btn" class="btn btn-primary" style="max-width: 200px;">
                            <span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true" style="display: none;"></span> <!-- Spinner -->
                            <span class="button-text">Fetch Tracked</span> <!-- Text -->
                        </button>
                         <span id="finviz-status" class="ms-1 mt-1 d-block small"></span> {# Moved status below button #}
                    </div>
                    {# --- End Column 1 --- #}

                    {# --- Column 2: Custom List --- #}
                    <div class="col-md-6">
                        <h6>Custom List</h6>
                        <p class="small text-muted mb-2">Upload a .txt file (one ticker per line).</p>
                        
                        {# Button First #}
                        <button id="run-finviz-upload-btn" class="btn btn-primary mb-2" disabled style="max-width: 200px;">
                            <span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true" style="display: none;"></span> <!-- Spinner -->
                            <span class="button-text">Fetch Uploaded</span> <!-- Text -->
                        </button>
                        <span id="finviz-upload-status" class="ms-1 mt-1 d-block small mb-2"></span> {# Status below button #}

                        {# Hidden File Input #}
                        <input type="file" id="ticker-file-input" accept=".txt" style="display: none;">

                        {# Drag and Drop Zone Below Button #}
                        <div id="drop-zone" class="mb-2" style="max-width: 200px;"> {# Apply max-width #}
                            <p>
                                <span class="status-icon bi bi-cloud-arrow-up me-2 align-middle"></span> {# Icon holder #}
                                <span class="status-text">Drag & drop .txt file or click</span> {# Text holder #}
                            </p>
                        </div>
                        
                    </div>
                    {# --- End Column 2 --- #}
                </div>
            </div>
            {# --- End Finviz Import Card --- #}

            {# --- Placeholder for Future Import Sources --- #}
            <!-- 
            <div class="my-3 p-3 border rounded bg-body-tertiary">
                <h5 class="mb-3">Import from [Other Source]</h5>
                </div>
            -->
            {# --- End Placeholder --- #}

        </div>
        {# --- End Data Import Tab Pane --- #}

        {# --- Data Preparation Tab Pane --- #}
        <div class="tab-pane fade" id="stage-prepare-tab-pane" role="tabpanel" aria-labelledby="stage-prepare-tab" tabindex="0">
            <h5>Data Preparation Steps</h5>
            <p>Process, clean, filter, and configure the imported data.</p>

            {# --- Raw Analytics Data Processing, Filtering & Configuration --- #}
            <div class="my-3 p-3 border rounded bg-body-tertiary">
                <h6>Process, Filter & Configure Raw Analytics Data</h6>

                {# --- Sub-Tab Navigation for Prep Steps --- #}
                <ul class="nav nav-tabs mt-3" id="prepStepsTabs" role="tablist">
                    {# --- NEW: Load Data Sub-Tab Button --- #}
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="load-data-subtab" data-bs-toggle="tab" data-bs-target="#load-data-subtab-pane" type="button" role="tab" aria-controls="load-data-subtab-pane" aria-selected="true">Load Data</button>
                    </li>
                    {# --- End Load Data Sub-Tab Button --- #}
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="config-subtab" data-bs-toggle="tab" data-bs-target="#config-subtab-pane" type="button" role="tab" aria-controls="config-subtab-pane" aria-selected="false">Field Configuration</button> {# Removed active, set aria-selected false #}
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="filter-subtab" data-bs-toggle="tab" data-bs-target="#filter-subtab-pane" type="button" role="tab" aria-controls="filter-subtab-pane" aria-selected="false">Filters & Output</button>
                    </li>
                </ul>
                {# --- End Sub-Tab Navigation --- #}

                {# --- Sub-Tab Content --- #}
                <div class="tab-content pt-3" id="prepStepsTabsContent">

                    {# --- NEW: Load Data Sub-Tab Pane --- #}
                    <div class="tab-pane fade show active" id="load-data-subtab-pane" role="tabpanel" aria-labelledby="load-data-subtab" tabindex="0">
                        <h6>Load Data</h6>
                        <p class="small text-muted">Load and process all raw analytics data currently stored in the database.</p>
                        {# Moved Button and Status Here #}
                        <button id="process-analytics-data-btn" class="btn btn-secondary me-2">Load Data from DB</button>
                        <span id="process-analytics-status" class="ms-2"></span> {# Status for the processing action #}
                    </div>
                    {# --- End Load Data Sub-Tab Pane --- #}

                    {# --- Field Configuration Sub-Tab Pane --- #}
                    <div class="tab-pane fade" id="config-subtab-pane" role="tabpanel" aria-labelledby="config-subtab" tabindex="0"> {# Removed show active #}

                        {# Container for Field Weights & Toggles #}
                        <div class="mb-3">
                            <!-- REMOVED Field Configuration H6 heading -->
                            <div id="field-config-container" style="max-height: 400px; overflow-y: auto;"> <!-- Increased height slightly -->
                                <!-- Field config rows will be added here dynamically -->
                                <p class="text-muted small">Load data to configure fields.</p>
                            </div>
                        </div>

                    </div>
                    {# --- End Field Configuration Sub-Tab Pane --- #}

                    {# --- Filters & Output Sub-Tab Pane --- #}
                    <div class="tab-pane fade" id="filter-subtab-pane" role="tabpanel" aria-labelledby="filter-subtab" tabindex="0">

                        {# Filter Controls #}
                        <div class="mb-3">
                            <h6>Filter Criteria:</h6>
                            <div id="filter-controls-container">
                                <!-- Filter rows will be added here dynamically -->
                            </div>
                            <button id="add-filter-btn" class="btn btn-sm btn-outline-success me-2">+ Add Filter</button>
                            <button id="apply-filters-btn" class="btn btn-sm btn-primary me-2">Apply Filters</button>
                            <button id="reset-filters-btn" class="btn btn-sm btn-outline-danger">Reset Filters</button>
                        </div>

                        {# Display area for processed output #}
                        <div id="processed-analytics-output-container" class="mt-3">
                            <h6>Filtered Output:</h6> <span id="filter-results-count" class="ms-2 small text-muted"></span>
                            <div class="table-responsive mt-2"> {# Make table horizontally scrollable on small screens #}
                                <table id="output-table" class="table table-striped table-bordered table-sm compact display" style="width:100%">
                                     <thead>
                                         {# Table headers will be added dynamically by JS #}
                                         <tr>
                                             {# Placeholder - will be replaced #}
                                             <th>Loading...</th>
                                         </tr>
                                     </thead>
                                     <tbody>
                                         {# Table body content will be added dynamically by JS #}
                                         {# Add a placeholder row or message? #}
                                         <tr>
                                             <td class="text-center text-muted small">Apply filters to view data.</td>
                                         </tr>
                                     </tbody>
                                </table>
                            </div>
                            {# --- End Table --- #}
                        </div>

                    </div>
                    {# --- End Filters & Output Sub-Tab Pane --- #}

                </div>
                {# --- End Sub-Tab Content --- #}

            </div>
            {# --- END Raw Analytics Data Processing, Filtering & Configuration --- #}

            {# Add other prep steps here later #}

        </div>
        {# --- End Data Preparation Tab Pane --- #}

        {# --- NEW Transform Tab Pane --- #}
        <div class="tab-pane fade" id="transform-tab-pane" role="tabpanel" aria-labelledby="transform-tab" tabindex="0">
            <h5>Data Transformation</h5>
            <p>Apply transformations, calculations, or feature engineering to the prepared data.</p>
            <div class="my-3 p-3 border rounded bg-body-tertiary">
                <div class="row">
                    {# --- Column 1: Rule Definition & Controls --- #}
                    <div class="col-md-6">
                        <h6>Define Transformations</h6>
                        <div id="transformation-rules-container" class="mb-3" style="min-height: 200px; max-height: 400px; overflow-y: auto; border: 1px solid var(--bs-border-color); padding: 10px; background-color: var(--bs-body-bg);">
                            <p class="text-muted small">No transformations defined yet. Click "+ Add Rule" to begin.</p>
                            <!-- Transformation rules will be listed here dynamically -->
                        </div>
                        <div class="mb-3"> {# Button Group #}
                            <button id="add-transformation-rule-btn" class="btn btn-sm btn-outline-success me-2" data-bs-toggle="modal" data-bs-target="#transformationRuleModal">
                                <i class="bi bi-plus-lg"></i> Add Rule
                            </button>
                            <button id="apply-transformations-btn" class="btn btn-sm btn-primary me-2">
                                <i class="bi bi-play-fill"></i> Apply Transformations
                            </button>
                             {# Placeholder for future buttons #}
                            <button id="save-transform-rules-btn" class="btn btn-sm btn-outline-secondary me-1" title="Save Rules to Browser"><i class="bi bi-save"></i></button>
                            <button id="load-transform-rules-btn" class="btn btn-sm btn-outline-secondary me-1" title="Load Rules from Browser"><i class="bi bi-folder2-open"></i></button>
                            {# <button id="export-transform-rules-btn" class="btn btn-sm btn-outline-secondary me-1" title="Export Rules to File"><i class="bi bi-box-arrow-down"></i></button> #}
                            {# <button id="import-transform-rules-btn" class="btn btn-sm btn-outline-secondary" title="Import Rules from File"><i class="bi bi-box-arrow-up"></i></button> #}
                        </div>
                        <div id="transform-status" class="mt-2 small text-muted"></div> {# Status message area #}
                    </div>
                    {# --- Column 2: Data Preview --- #}
                    <div class="col-md-6">
                        <h6>Transformed Data Preview (First 10 Rows)</h6>
                        <pre id="transformed-data-output" class="p-2 border rounded" style="max-height: 450px; overflow: auto; font-size: 0.75rem; white-space: pre; word-wrap: normal; background-color: var(--bs-tertiary-bg); color: var(--bs-body-color);"></pre>
                    </div>
                </div>

                {# --- Transformation Rule Editor Modal (Placeholder Structure) --- #}
                <div class="modal fade" id="transformationRuleModal" tabindex="-1" aria-labelledby="transformationRuleModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false"> {# Static backdrop, no keyboard close #}
                    <div class="modal-dialog modal-lg"> {# Larger modal #}
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="transformationRuleModalLabel">Define Transformation Rule</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <input type="hidden" id="transform-rule-id"> {# For editing existing rules #}
                                
                                {# --- Basic Rule Info --- #}
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="transform-rule-type" class="form-label form-label-sm">Rule Type:</label>
                                        <select id="transform-rule-type" class="form-select form-select-sm">
                                            <option value="" selected disabled>-- Select Type --</option>
                                            {# Options will be added dynamically via JS #}
                                            {# Examples:
                                            <option value="arithmetic">Arithmetic Formula</option>
                                            <option value="ratio">Ratio (Field A / Field B)</option>
                                            <option value="weighted_sum">Weighted Sum</option>
                                            <option value="normalize">Normalize (Min/Max)</option>
                                            <option value="conditional_map">Conditional Mapping</option>
                                            <option value="text_concat">Concatenate Text</option>
                                             ... more later ... 
                                            #}
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="transform-output-name" class="form-label form-label-sm">New Field Name:</label>
                                        <input type="text" id="transform-output-name" class="form-control form-control-sm" placeholder="e.g., ProfitMargin, NormalizedScore">
                                        <div id="output-name-feedback" class="invalid-feedback small"></div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="transform-rule-comment" class="form-label form-label-sm">Comment (Optional):</label>
                                    <input type="text" id="transform-rule-comment" class="form-control form-control-sm" placeholder="Describe what this rule does">
                                </div>
                                <hr>
                                
                                {# --- Dynamic Parameter Section --- #}
                                <div id="transform-parameters-container">
                                    <p class="text-muted small text-center">Select a Rule Type to configure parameters.</p>
                                    {# Rule-specific parameters will be injected here by JS #}
                                </div>
                                {# --- End Dynamic Parameter Section --- #}
                                
                            </div>
                            <div class="modal-footer">
                                <span id="transform-modal-status" class="me-auto text-danger small"></span> {# For modal-specific errors #}
                                <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-sm btn-primary" id="save-transformation-rule-btn">Save Rule</button>
                            </div>
                        </div>
                    </div>
                </div>
                {# --- End Modal --- #}
            </div>
        </div>
        {# --- End Transform Tab Pane --- #}

        {# --- Data Report Tab Pane --- #}
        <div class="tab-pane fade" id="analyze-present-tab-pane" role="tabpanel" aria-labelledby="analyze-present-tab" tabindex="0">
            <h5>Analyze & Present Data</h5>
            <p>Generate reports, visualizations, or summaries based on the prepared data.</p>
            
            {# --- Chart Controls & Display --- #}
            <div class="my-3 p-3 border rounded bg-body-tertiary">
                <div class="row mb-3 gy-2 gx-2 align-items-end"> <!-- Add gutters (gx-2, gy-2) and align items end -->
                    <!-- X-axis Selector (Expands) -->
                    <div class="col-md">
                        <label for="report-x-axis-selector" class="form-label mb-1">X-axis:</label>
                        <select id="report-x-axis-selector" class="form-select form-select-sm">
                            <option value="index" selected>-- Record Index (Default) --</option> {# Ensure selected #}
                            {# Options will be populated by JavaScript #}
                        </select>
                    </div>
                    <!-- Swap Button (Fixed Width) -->
                    <div class="col-auto">
                        <button id="swap-axes-btn" class="btn btn-sm btn-outline-secondary" title="Swap X and Y axes">
                            <i class="bi bi-arrow-left-right"></i>
                        </button>
                    </div>
                    <!-- Y-axis Selector (Expands) -->
                    <div class="col-md">
                        <label for="report-field-selector" class="form-label mb-1">Y-axis:</label>
                        <select id="report-field-selector" class="form-select form-select-sm">
                            <option value="">-- Select Field --</option>
                            {# Options will be populated by JavaScript #}
                        </select>
                    </div>
                    <!-- Color Selector (Fixed Width) -->
                    <div class="col-md-2">
                        <label for="report-color-selector" class="form-label mb-1">Color By:</label>
                        <select id="report-color-selector" class="form-select form-select-sm">
                            <option value="">-- None --</option> {# Simplified default text #}
                            {# Options will be populated by JavaScript #}
                        </select>
                    </div>
                    <!-- Size Selector (Fixed Width) -->
                    <div class="col-md-2">
                        <label for="report-size-selector" class="form-label mb-1">Size By:</label>
                        <select id="report-size-selector" class="form-select form-select-sm" disabled>
                            <option value="">-- Bubble Only --</option> {# Simplified default text #}
                            {# Options will be populated by JavaScript #}
                        </select>
                    </div>
                    <!-- Chart Type Selector (Fixed Width) -->
                    <div class="col-md-2">
                        <label for="report-chart-type-selector" class="form-label mb-1">Type:</label>
                        <select id="report-chart-type-selector" class="form-select form-select-sm">
                            <option value="scatter" selected>Scatter</option>
                            <option value="line">Line</option>
                            <option value="bar">Bar</option>
                            <option value="bubble">Bubble</option>
                        </select>
                    </div>
                    <!-- Reset Button (Fixed Width) -->
                    <div class="col-auto">
                        <button id="reset-chart-btn" class="btn btn-sm btn-outline-secondary" title="Reset Zoom/Pan">Reset View</button> {# Changed title and text #}
                    </div>
                </div>
                <div id="report-chart-container" style="position: relative; height:40vh; width:80vw">
                    <canvas id="report-chart-canvas"></canvas>
                </div>
                <div id="chart-status" class="mt-2 small text-muted"></div>
            </div>
            {# --- End Chart Controls & Display --- #}

            <p class="text-muted small"><i>(Other reporting features will be added here later)</i></p>
        </div>
        {# --- End Data Report Tab Pane --- #}

    </div>
    {# --- End Main Tab Content --- #}

    <!-- Add other analytics-specific content here later -->

    {# --- Numeric Format Configuration Modal --- #}
    <div class="modal fade" id="numericFormatModal" tabindex="-1" aria-labelledby="numericFormatModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="numericFormatModalLabel">Configure Format for <span id="format-field-name" class="fw-bold"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="format-current-field"> {# Store field name #}
                    
                    <div class="mb-3 row">
                        <label for="format-decimals" class="col-sm-4 col-form-label col-form-label-sm">Decimals:</label>
                        <div class="col-sm-8">
                            <input type="number" class="form-control form-control-sm" id="format-decimals" min="0" step="1" placeholder="Auto">
                            <div class="form-text form-text-sm">Leave blank for automatic decimal places.</div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="format-prefix" class="col-sm-4 col-form-label col-form-label-sm">Prefix:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="format-prefix" placeholder="e.g., $">
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="format-suffix" class="col-sm-4 col-form-label col-form-label-sm">Suffix:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm" id="format-suffix" placeholder="e.g., %, K, M">
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label col-form-label-sm">Separator:</label>
                        <div class="col-sm-8">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="format-use-separator">
                                <label class="form-check-label small" for="format-use-separator">Use thousands separator (e.g., 1,000)</label>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary btn-sm" id="save-format-btn">Save Format</button>
                </div>
            </div>
        </div>
    </div>
    {# --- End Modal --- #}

{% endblock %}

{% block scripts %}
    {# --- jQuery (must come before DataTables) --- #}
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    {# --- DataTables JS (including Bootstrap 5 integration) --- #}
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

    {# Add any page-specific JavaScript here if needed later #}
    <!-- Original script block removed, content moved to /static/js/analytics.js -->
    <script src="/static/js/analytics.js"></script>
    <script src="/static/js/analytics_transform.js"></script>
{% endblock %}

<!-- Popper.js -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<!-- Chart.js Zoom Plugin -->
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>

<!-- Custom App JS -->
{# REMOVED DUPLICATE SCRIPT TAG FROM HERE #}

</body>
</html>